<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authenticated</title>
    <style>
        body {
            background-color: white;
        }
    </style>
</head>
<body>
	<h1>Authenticated</h1>
	All authenticated Azure Active Directory users can access this page.
	<div class="container">
		<button type="button" class="btn skilheaderDivBtn pop ga-onWelcomeSection" title="" id="btnEdit">Edit</button>
		<div class="row">
			<div class="col-xs-12 col-sm-6 greenText" id="demo">

			</div>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<script>

		
			

				async function getUsername() {
					// call the endpoint
					alert("Hello");
					const response = await fetch('/.auth/me');
					// convert to JSON
					const json = await response.json();
					// ensure clientPrincipal and userDetails exist
					if (json.clientPrincipal && json.clientPrincipal.userDetails) {
						
						var a = json.clientPrincipal.userDetails;
						// return userDetails (the username)
						alert(a);
						if (a == 'ANURROY')
						{

							$(".btn skilheaderDivBtn pop ga-onWelcomeSection").hide();
							alert("Hello1");
						}
						//return json.clientPrincipal.userDetails;
					} else {
						// return null if anonymous
						return null;
					}
		        }
				debugger;
		//  getUsername();
		
			$(document).ready(function () {
				getUsername();
				triggerLogicApp();
			});

			function triggerLogicApp() {
				$.ajax({
					url: "https://prod-29.centralus.logic.azure.com:443/workflows/d06c1204588140d0b2c2cf205a6f8361/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=axi7WejBGnq7aknHGnw2vGbrlcVNxJh1wjnCUxprzwo",
					type: "POST",
					dataType: "json",
					headers: {
						"content-type": "application/json"
					},
					success: function (data) {
						alert("Success");
						debugger;
						const Vdata = data;
						var text = "";
						for (let i = 0; i < Vdata.Table1.length; i++) {
							text += Vdata.Table1[i].ParagraphText
						}
						var myJSON = text;
						document.getElementById("demo").innerHTML = myJSON;
					},
					error: function (data) {
						console.log("Error getting token");
						console.log(JSON.stringify(data));
					}
				});
			}</script>

</body>
</html>